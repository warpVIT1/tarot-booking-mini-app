<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞—Ä–æ–ª–æ–≥–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .registration-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: var(--bg-color);
        }

        .registration-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .registration-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .registration-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 2px solid var(--primary-color);
            box-shadow: var(--shadow-hover);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .requirement-list {
            list-style: none;
            padding: 0;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .requirement-icon {
            color: var(--success-color);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .warning-box {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid var(--warning-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0;
        }

        .warning-title {
            color: var(--warning-color);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .benefit-item {
            text-align: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: var(--transition);
        }

        .benefit-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .benefit-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .benefit-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .benefit-desc {
            font-size: 0.85rem;
            color: var(--hint-color);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .register-btn {
            flex: 2;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .register-btn:active {
            transform: scale(0.98);
        }

        .back-btn {
            flex: 1;
            background: transparent;
            color: var(--hint-color);
            border: 2px solid var(--border-color);
            padding: 15px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .back-btn:hover {
            background: var(--card-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .success-message {
            background: var(--card-bg);
            border: 2px solid var(--success-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .success-icon {
            font-size: 3rem;
            color: var(--success-color);
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="registration-container">
        <div class="registration-header">
            <div class="registration-icon">üîÆ</div>
            <h1>–°—Ç–∞—Ç—å —Ç–∞—Ä–æ–ª–æ–≥–æ–º</h1>
            <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–æ–ª–æ–≥–æ–≤</p>
        </div>

        <div class="registration-card" id="registration-form">
            <div class="form-section">
                <h3>üéØ –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:</h3>
                <div class="benefits-grid">
                    <div class="benefit-item">
                        <div class="benefit-icon">üìÖ</div>
                        <div class="benefit-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</div>
                        <div class="benefit-desc">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–¥–æ–±–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üë•</div>
                        <div class="benefit-title">–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        <div class="benefit-desc">–í–∞—à–∞ –ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üí∞</div>
                        <div class="benefit-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</div>
                        <div class="benefit-desc">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ —Ç–∞—Ä–∏—Ñ—ã</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üìä</div>
                        <div class="benefit-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                        <div class="benefit-desc">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</h3>
                <ul class="requirement-list">
                    <li class="requirement-item">
                        <span class="requirement-icon">‚úì</span>
                        <span>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–∞–º–∏ –¢–∞—Ä–æ</span>
                    </li>
                    <li class="requirement-item">
                        <span class="requirement-icon">‚úì</span>
                        <span>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–æ–¥–∏—Ç—å –æ–Ω–ª–∞–π–Ω –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</span>
                    </li>
                    <li class="requirement-item">
                        <span class="requirement-icon">‚úì</span>
                        <span>–°–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–∏–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                    </li>
                    <li class="requirement-item">
                        <span class="requirement-icon">‚úì</span>
                        <span>–ê–∫–∫–∞—É–Ω—Ç –≤ Telegram</span>
                    </li>
                </ul>
            </div>

            <div class="warning-box">
                <div class="warning-title">
                    ‚ö†Ô∏è –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:
                </div>
                <p>–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∫ —Ç–∞—Ä–æ–ª–æ–≥, –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –±–æ—Ç –≤–∞–º –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–æ–ª–æ–≥–∞. –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É —Ä–µ–∂–∏–º—É –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.</p>
            </div>

            <div class="form-section">
                <h3>üë§ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ:</h3>
                <div class="form-group">
                    <label>–í–∞—à–µ –∏–º—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:</label>
                    <input type="text" id="tarot-name" placeholder="–ö–∞–∫ –≤–∞—Å –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –∫–ª–∏–µ–Ω—Ç—ã" required>
                </div>

                <div class="form-group">
                    <label>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</label>
                    <select id="experience" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—ã—Ç</option>
                        <option value="beginner">–ù–∞—á–∏–Ω–∞—é—â–∏–π (–¥–æ 1 –≥–æ–¥–∞)</option>
                        <option value="intermediate">–ü—Ä–∞–∫—Ç–∏–∫—É—é—â–∏–π (1-3 –≥–æ–¥–∞)</option>
                        <option value="advanced">–û–ø—ã—Ç–Ω—ã–π (3-5 –ª–µ—Ç)</option>
                        <option value="expert">–≠–∫—Å–ø–µ—Ä—Ç (–±–æ–ª–µ–µ 5 –ª–µ—Ç)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</label>
                    <textarea id="specialization" rows="3" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è—Ö –∏ –ø–æ–¥—Ö–æ–¥–∞—Ö"></textarea>
                </div>

                <div class="form-group">
                    <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (‚ÇΩ):</label>
                    <input type="number" id="price" placeholder="2000" min="100" max="10000">
                    <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞: 1500-3000 ‚ÇΩ</small>
                </div>

                <div class="form-group">
                    <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                    <input type="text" id="contact" placeholder="Telegram, WhatsApp –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏">
                </div>
            </div>

            <div class="action-buttons">
                <button class="back-btn" onclick="goBack()">–ù–∞–∑–∞–¥</button>
                <button class="register-btn" onclick="registerAsTarot()">
                    üîÆ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
            </div>
        </div>

        <div class="success-message" id="success-message">
            <div class="success-icon">üéâ</div>
            <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
            <p>–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ —Ç–∞—Ä–æ–ª–æ–≥.</p>
            <p>–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –±–æ—Ç –≤–∞–º –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–∞–Ω–µ–ª—å —Ç–∞—Ä–æ–ª–æ–≥–∞.</p>
            <button class="primary-btn" onclick="openTarotPanel()" style="margin-top: 20px;">
                –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Ç–∞—Ä–æ–ª–æ–≥–∞
            </button>
        </div>
    </div>

    <!-- JavaScript –º–æ–¥—É–ª–∏ -->
    <script src="js/config.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
            TelegramApp.init();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            checkUserAuth();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function checkUserAuth() {
            const telegramUser = TelegramApp.getUserData();

            if (!telegramUser && !CONFIG.DEV_MODE) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram');
                goBack();
                return;
            }

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–º—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if (telegramUser) {
                const nameField = document.getElementById('tarot-name');
                if (nameField && !nameField.value) {
                    nameField.value = telegramUser.firstName + (telegramUser.lastName ? ' ' + telegramUser.lastName : '');
                }
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ —Ç–∞—Ä–æ–ª–æ–≥
        function registerAsTarot() {
            const name = document.getElementById('tarot-name').value.trim();
            const experience = document.getElementById('experience').value;
            const specialization = document.getElementById('specialization').value.trim();
            const price = document.getElementById('price').value;
            const contact = document.getElementById('contact').value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name) {
                alert('–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }

            if (!experience) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã');
                return;
            }

            if (!specialization) {
                alert('–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const telegramUser = TelegramApp.getUserData() || CONFIG.DEV_USER;

            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Ç–∞—Ä–æ–ª–æ–≥–∞
            const tarotProfile = {
                id: telegramUser.id,
                telegramId: telegramUser.id,
                firstName: telegramUser.first_name || telegramUser.firstName,
                lastName: telegramUser.last_name || telegramUser.lastName || '',
                username: telegramUser.username || '',
                role: CONFIG.USER_ROLES.TAROT,
                languageCode: telegramUser.language_code || 'ru',
                isPremium: telegramUser.is_premium || false,
                photoUrl: telegramUser.photo_url || '',
                registeredAt: new Date().toISOString(),

                // –î–∞–Ω–Ω—ã–µ —Ç–∞—Ä–æ–ª–æ–≥–∞
                tarotData: {
                    displayName: name,
                    experience: experience,
                    specialization: specialization,
                    price: parseInt(price) || 2000,
                    contact: contact,
                    isActive: true,
                    rating: 0,
                    totalConsultations: 0,
                    clientBookingLink: generateTarotBookingLink(telegramUser.id)
                },

                // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫ —ç—Ç–æ–º—É —Ç–∞—Ä–æ–ª–æ–≥—É
                tarotReferralCode: 'tarot_' + telegramUser.id
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            Storage.set(CONFIG.STORAGE_KEYS.USER_DATA, tarotProfile);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ —Ç–∞—Ä–æ–ª–æ–≥–æ–≤
            const tarotsList = Storage.get('tarots_list') || [];
            const existingIndex = tarotsList.findIndex(t => t.id === telegramUser.id);

            if (existingIndex >= 0) {
                tarotsList[existingIndex] = tarotProfile;
            } else {
                tarotsList.push(tarotProfile);
            }

            Storage.set('tarots_list', tarotsList);

            ConfigUtils.log('–¢–∞—Ä–æ–ª–æ–≥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', tarotProfile);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
            showSuccessMessage();

            // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            TelegramApp.hapticFeedback('success');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showSuccessMessage() {
            document.getElementById('registration-form').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫ —Ç–∞—Ä–æ–ª–æ–≥—É
        function generateTarotBookingLink(tarotId) {
            return ConfigUtils.createTarotBookingLink(tarotId);
        }

        // –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Ç–∞—Ä–æ–ª–æ–≥–∞
        function openTarotPanel() {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ø–∞–Ω–µ–ª—å —Ç–∞—Ä–æ–ª–æ–≥–∞
            window.location.href = 'tarot-panel.html';
        }

        // –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            ConfigUtils.toggleTheme();
            if (typeof TelegramApp !== 'undefined') {
                TelegramApp.hapticFeedback('selection');
            }
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem(CONFIG.STORAGE_KEYS.THEME_OVERRIDE);

            if (savedTheme) {
                ConfigUtils.setTheme(savedTheme);
            } else {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é —Ç–µ–º—É
                ConfigUtils.detectAndSetTheme();
            }
        });
    </script>
</body>
</html>